---
title: "Jointures"
description: "TP2"
author: "Ludovic Deneuville"
format: 
  html:
    toc: true
    toc-location: left
    toc-expand: 3
from: markdown+emoji
number-sections: true
number-depth: 3
lightbox: true
---


:construction:

## Lancement des services

### Datalab du GENES ou SSPCloud

Connectez-vous à l'une des 2 instances suivantes (elles sont quasiment identiques) :

- [ ] [Datalab du GENES](https://onyxia.lab.groupe-genes.fr/){target="_blank"}
- [ ] [Datalab SSPCloud de l'INSEE](https://datalab.sspcloud.fr/){target="_blank"} 
  - en créant un compte avec votre mail ENSAI

::: {.callout-tip}
Pour éviter les problèmes de charges :

- Les élèves fonctionnaires feront le TP sur le SSPCloud
- Les élèves ingénieurs :arrow_right: Datalab du GENES
:::

### Base de données PostgreSQL

::: {.callout-note}
Lors du premier TP, nous avons utilisé des données de fichiers parquet lus directement avec DuckDB.

Aujourd'hui, nous allons :

- Créer notre propre base de données [PostgreSQL](https://www.postgresql.org/){target="_blank"}
- Créer des schémas et des tables
- Insérer des données
- Requêter ces données
:::

- [ ] Lancez le service PostgreSQL
  - Allez dans **Catalogue de services**
  - Onglet **Databases**
- [ ] Copiez-collez dans un fichier texte les informations de connexion PostgreSQL : Hostname, Port, Database, Username, Password

### CloudBeaver

- [ ] Lancez le service [CloudBeaver](https://dbeaver.com/docs/cloudbeaver/){target="_blank"}
  - Allez dans **Catalogue de services**
  - Onglet **Databases**
- [ ] Copiez-collez également les informations de connexion au service *CloudBeaver*
- [ ] Ouvrez ce service

Normalement la connexion à la base de données *PostgreSQL* est détectée automatiquement.

Dans le cas contraire, il faut cliquer sur le +, puis sur *New connection* et resenigné les éléments de connexion.

- [ ] Dans l'explorateur à gauche, clic droit sur bdd PostgreSQL :arrow_right: SQL Editor

Cela ouvre une fenêtre où vous pouvez écrire du code SQL pour interagir avec votre base de données.

## Exercices

### École de musique

Nous allons commencer par créer les tables et insérer les données :

- [ ] Copiez le contenu de ce [script sql](./data/tp2-musique-create-pop.sql){target="_blank"} 
- [ ] Collez dans la fenêtre SQL de CloudBeaver
- [ ] Exécutez le script
  - Cliquez sur la petite icone sous les triangles oranges qui ressemble à :scroll:
  - raccourci (ALT + X)
- [ ] Vérifiez que votre schéme et vos tables sont créés
  - Dans l'explorateur : PostgreSQL :arrow_right: Databases :arrow_right: defaultdb :arrow_right: Schemas
  - Clic droit sur *Schemas* :arrow_right: Refresh

Si tout est ok, vous n'avez plus besoin du script de création et d'insertion de données.

- [ ] Supprimez le contenu du code SQL ou ouvrez un nouvel éditeur SQL

Voici le modèle de données :

![](./data/tp2-musique-modele.PNG)

Vous pouvez maintenant commencer l'exercice et écrire les requêtes permettant de répondre aux questions suivantes :

- [ ] Quels sont les noms des adhérents
- [ ] Quels sont les noms des instruments présents dans la base de données
- [ ] Quelle est l’adresse de l’adhérent numéro 15
- [ ] Quels sont les numéros des adhérents de nom `DUPONT`
- [ ] Donnez le(s) nom(s) de l'instrument(s) dont joue l'adhérent numéro 15
- [ ] Donnez le nom des adhérents inscrits au cours numéro 6
- [ ] Donnez les noms des adhérents inscrits au cours de guitare classique (le nom du cours est `GUIT-CLASS`)
- [ ] Quels sont les cours auxquels sont inscrits les adhérents qui jouent du piano
- [ ] De quels instruments jouent les personnes inscrites au cours de guitare classique


### Location de DVD

Il fut un temps où des entreprises se spécialisaient dans la location de DVD. Dans cet exercice une telle entreprise souhaite informatiser la gestion des prêts.

De la même manière que pour le premier exercice, chargez les données avec ce [script sql](./data/tp2-dvd-create-pop.sql){target="_blank"} 

Modèle de données :

![](./data/tp2-dvd-modele.PNG)

Donnez les requêtes pour obtenir :

- [ ] Nom et prénom des adhérents 
- [ ] Titre des films de la base 
- [ ] Numéro d’adhérent de `Pierre DUCHEMIN`
- [ ] Nom, Prénom et adresse de tous les `DUCHEMIN`
- [ ] Numéro des DVD du film `la guerre des etoiles`
- [ ] Nom, Prénom des adhérents ayant emprunté le film `la guerre des etoiles »
- [ ] Nom, Prénom des adhérents ayant au moins un emprunt en cours (la date de fin de l’emprunt est nulle) 
- [ ] Nom, Prénom du réalisateur de la `Guerre des étoiles`
- [ ] Titre des films empruntés par pierre `DUCHEMIN`
- [ ] Nom des réalisateurs des films empruntés par `pierre DUCHEMIN`
- [ ] Nom des réalisateurs de films de science fiction ou policiers 

Les questions ci-dessous nécessitent une opération de l'algèbre relationnelle ou un concept non vu au CM1 

- [ ] Nom et prénom des adhérents ayant emprunté des films de Science fiction mais pas de films policiers 
- [ ] Nom et prénom des adhérents ayant emprunté au moins un film de Science fiction et un film policier 
- [ ] Titre des films jamais empruntés 
- [ ] Titre des films Science fiction jamais empruntés 
- [ ] Titre des films empruntés par les adhérents n’ayant pas emprunté `les choristes`
